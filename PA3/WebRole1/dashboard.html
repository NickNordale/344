<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
</head>
<body>
    <button id="start-crawling" class="btn btn-primary">Start crawling</button>

    <button id="clear-everything" class="btn btn-danger">Clear everything</button>

    <div>
        <p><span class="h3">State: </span><span id="state" class="results"></span></p>
    </div>

    <div>
        <p><span class="h6">CPU Utilization%: </span><span id="cpu" class="results"></span></p>
        <p><span class="h6">RAM available: </span><span id="ram" class="results"></span></p>
    </div>
    
    <div>
        <p><span class="h4"># of URLs visited: </span><span id="url-count" class="results"></span></p>
    </div>
    
    <div>
        <span class="h4">Last 10 URLs Visited:</span>
        <div id="last-10"></div>
    </div>
    
    <div>
        <p><span class="h4">Queue size: </span><span id="queue-size" class="results"></span></p>
    </div>

    <div>
        <p><span class="h4">Table size: </span><span id="table-size" class="results"></span></p>
    </div>
    
    <div>
        <span class="h4">Errors:</span>
        <div id="errors"></div>
    </div>

    <form>
        <fieldset>
            <label for="get-page-title">Search for page titles by url:</label>
            <input type="text" id="get-page-title" class="form-control" placeholder="enter url"/>
            <button id="get-page-title-submit" class="btn btn-primary">Search</button>
        </fieldset>
    </form>
    <p id="get-page-title-res"></p>

    <script type="text/javascript">
        function loadAll() {
            getState();
            getQueueSize();
            loadData();
            getLast10();
        }

        function getQueueSize() {
            $.ajax({
                type: "POST",
                url: "admin.asmx/getQueueSize",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#queue-size").text(data.d);
                },
                error: function () {
                    console.log("error");
                }
            });
        }

        function getState() {
            $.ajax({
                type: "POST",
                url: "admin.asmx/getState",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#state").text(data.d);
                },
                error: function () {
                    console.log("error");
                }
            });
        }

        function getLast10() {
            $.ajax({
                type: "POST",
                url: "admin.asmx/getLast10",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    var lastTenArr = $.parseJSON(data.d);
                    var tempStr = "";
                    $.each(lastTenArr, function (index, value) {
                        tempStr += "<p>" + value + "</p>";
                    });
                    $("#last-10").html(tempStr);
                },
                error: function () {
                    console.log("error");
                }
            });
        }

        $("#get-page-title-submit").click(function () {
            $.ajax({
                type: "POST",
                url: "admin.asmx/search",
                data: "{'url':'" + $("#get-page-title").val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    var possibleArray = $.parseJSON(data.d);
                    $("#get-page-title-rest").text(possibleArray.Title);
                },
                error: function () {
                    console.log("error");
                }
            });
        });

        $("#start-crawling").click(function () {
            $.ajax({
                type: "POST",
                url: "admin.asmx/startCrawling",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                   
                },
                error: function () {
                    console.log("error");
                }
            });
        });

        function getErrors() {
            $.ajax({
                type: "POST",
                url: "admin.asmx/getErrors",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    var errorArr = $.parseJSON(data.d);
                    if (errorArr.length != 0) {
                        var tempStr = "";
                        $.each(errorArr, function (index, value) {
                            tempStr += "<p>" + value + "</p>";
                        });
                        $("#errors").html(tempStr);
                    } else {
                        $("#errors").html("<p>No errors yet.</p>");
                    }
                },
                error: function () {
                    console.log("error");
                }
            });
        }

        function loadData() {
            $.ajax({
                type: "POST",
                url: "admin.asmx/getData",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    var possibleArray = $.parseJSON(data.d);
                    $("#cpu").text(possibleArray.CPU);
                    $("#ram").text(possibleArray.RAM);
                    $("#url-count").text(possibleArray.UrlCount);
                    $("#table-size").text(possibleArray.TableCount);
                    getErrors();
                },
                error: function () {
                    console.log("error");
                }
            });
        };

        loadAll();
        setInterval(function() {
            loadAll()
        }, 10000);
    </script>
</body>
</html>
